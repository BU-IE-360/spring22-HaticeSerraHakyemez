---
title: "IE360 Homework1"
author: "Hatice Serra Hakyemez"
date: "09/04/2022"
output: html_document
---

```{r libraries, include=FALSE,message=FALSE,warning=FALSE}
require(zoo)
require(lubridate)
require(openxlsx)
require(ggplot2)
require(data.table)
require(skimr)
require(GGally)
require(ggcorrplot)


data_path="C:/Users/user/Desktop/Data/TotalLoans.xlsx"
loans=read.xlsx(data_path,sheet='EVDS',rows=1:61)

data_path="C:/Users/user/Desktop/Data/ConsumerPriceIndex.xlsx"
cpi=read.xlsx(data_path,sheet='EVDS',rows=1:61)

data_path="C:/Users/user/Desktop/Data/ExchangeRates.xlsx"
exchange=read.xlsx(data_path,sheet='EVDS',rows=1:61)

exhcange=data.table(exchange)
setnames(exchange,"TP.DK.USD.S.YTL","USD")

cpi=data.table(cpi)
setnames(cpi,"TP.FG.J0","General")
setnames(cpi,"TP.TUFE1YI.T1","PPI")
setnames(cpi,"TP.FG.J07","Transport")

loans=data.table(loans)
setnames(loans,"TP.KREDI.L013(100th)","Commercial")
setnames(loans,"TP.TUKKRE.K001(100th)","Consumer")
loans[,"TP.KREDI.L013":=NULL]
loans[,"TP.TUKKRE.K001":=NULL]

analysis=NULL
analysis=merge(cpi,loans,key="Date")
analysis=merge(analysis,exchange,key="Date")
analysis[,Date:=as.yearmon(ym(Date))]

```

# Introduction

  Economic variables are variables of economy collected in a country. There can be correlation between various different economic variables, and they usually show a pattern over time. Therefore studying these variables is an excellent way to learn more about time series analysis and understand how real life trends and dependencies work.
  
  In this study, several economic variables and their relationships are analyzed, in order to find an answer to and draw conclusions about the question: "What is the relationship between price indices, exchange rates and bank loan amounts in the economy of Turkey over the years 2017-2021?"

# Visualization of Data
## Time Series Plots


```{r TimeSeries, echo=FALSE}
ggplot(analysis, aes(x=Date,y=USD))+geom_line()+labs(x="Date",
y="USD Exchange Rate",title="USD-TRY Exchange Rate Change",subtitle = "Over years 2017-2021")
ggplot(analysis, aes(x=Date,y=General))+geom_line()+labs(x="Date",
y="General Price Index",title="General Price Index Change",subtitle = "Over years 2017-2021")
ggplot(analysis, aes(x=Date,y=PPI))+geom_line()+labs(x="Date",
y="PPI",title="Producer Price Index Change",subtitle = "Over years 2017-2021")
ggplot(analysis, aes(x=Date,y=Transport))+geom_line()+labs(x="Date",
y="Transport Price Index",title="Transport Price Index Change",subtitle = "Over years 2017-2021")
ggplot(analysis, aes(x=Date,y=Commercial))+geom_line()+labs(x="Date",
y="Commercial Loans",title="Commercial Loan Change",subtitle = "Over years 2017-2021")
ggplot(analysis, aes(x=Date,y=Consumer))+geom_line()+labs(x="Date",
y="Consumer Loans",title="Consumer Loan Change",subtitle = "Over years 2017-2021")
```

# Selecting Data

```{r select,echo=FALSE}
ggplot(analysis ,aes(x=Date)) +
  geom_line(aes(y=General,color="General")) +
  geom_line(aes(y=PPI,color="PPI")) +
  geom_line(aes(y=Transport,color='Transport'))+
  ggtitle("Price Indices Comparison",subtitle = "Over years 2017-2021")+xlab("Date")+ylab("Price Index")

ggplot(analysis ,aes(x=Date)) +
  geom_line(aes(y=Commercial,color='Commercial')) +
  geom_line(aes(y=Consumer,color='Consumer'))+
 ggtitle("Loan Amount Comparison",subtitle = "Over years 2017-2021")+xlab("Date")+ylab("Total Loan")


correl_info=cor(analysis[,-1])
ggcorrplot(correl_info, 
           hc.order = TRUE, 
           type = "lower",
           lab = TRUE)+
  ggtitle("Correlation Between Variables")

```

   It can be seen from the price index comparison graph that, over the years all three price indices showed a very similar pattern of growth. Since general price index consists of a wider range of products and services, it is sufficient enough to use this variable in the further analysis.
   
   Looking at the loan amount comparison graph, one can say there is a similar trend.
   

``` {r S,echo=FALSE}
veri=analysis[,c(1,2,6,7)]
ggpairs(veri[,-1])+ggtitle("Pairs Correlation of The Data")
ggplot(veri,aes(x=USD)) + geom_density(fill="red") +labs(x="Exchange Rate",
y="Density",title="USD-TRY Exchange Rate Density",subtitle = "Over years 2017-2021")+ facet_wrap(~year(Date))
ggplot(veri,aes(x=General)) + geom_density(fill="blue") +labs(x="Price Index",
y="Density",title="General Price Index Density",subtitle = "Over years 2017-2021")+ facet_wrap(~year(Date))
ggplot(veri,aes(x=Consumer)) + geom_density(fill="green") +labs(x="Consumer Loan",
y="Density",title="Consumer Loan Density",subtitle = "Over years 2017-2021") + facet_wrap(~year(Date))

ggplot(veri,aes(x=USD)) + geom_density(fill="red")+labs(x="USD Exchange Rate",
y="Density",title="Density Graph of USD Exchange Rate",subtitle = "Over years 2017-2021")
paste("Mean USD exchange rate: ",mean(veri$USD))
paste("Variance of USD exchange rate: ",var(veri$USD))

ggplot(veri,aes(x=General)) + geom_density(fill="blue")+labs(x="General Price Index",
y="Density",title="Density Graph of General Price Index",subtitle = "Over years 2017-2021")
paste("Mean general price index: ",mean(veri$General))
paste("Variance of general price index: ",var(veri$General))

ggplot(veri,aes(x=Consumer)) + geom_density(fill="green")+labs(x="Consumer Loan Amount",
y="Density",title="Density Graph of Consumer Loan Amount",subtitle = "Over years 2017-2021")
paste("Mean consumer loan amount: ",mean(veri$Consumer)) 
paste("Variance of consumer loan amount: ",var(veri$Consumer))
```

# Normalized Data

```{r y,echo=FALSE}
GeneralN=(veri$General-min(veri$General))/(max(veri$General)-min(veri$General))
USDN=(veri$USD-min(veri$USD))/(max(veri$USD)-min(veri$USD))
ConsumerN=(veri$Consumer-min(veri$Consumer))/(max(veri$Consumer)-min(veri$Consumer))

ggplot(veri ,aes(x=Date)) +
  geom_line(aes(y=GeneralN,color="General")) +
  geom_line(aes(y=USDN,color="USD")) +
  geom_line(aes(y=ConsumerN,color='Consumer'))+labs(x="Date",y="Normalized Data",
title="Normalized Price Index, Exchange Rate, Loan Amount",subtitle="Over Years 2017-2021")

ggplot(veri) + geom_density(aes(x=GeneralN),color="blue")+ geom_density(aes(x=USDN),color="red")+ geom_density(aes(x=ConsumerN),color="green")+labs(x="Normalized Data",y="Density",
title="Densities of Normalized Price Index, Exchange Rate, Loan Amount",subtitle="Over Years 2017-2021")

```

# Comparison 

```{r comp,echo=FALSE}
par(mfrow=c(2,2))
plot(y=veri$USD,x=veri$Date,type="l",xlab="Date",ylab="Exchange Rate",main="Time Series of USD Exchange Rate")
plot(y=veri$General,x=veri$Date,type="l",xlab="Date",ylab="General Price Index",main="Time Series of General Price Index")
plot(y=veri$Consumer,x=veri$Date,type="l",xlab="Date",ylab="Consumer Loan",main="Time Series of Consumer Loan Amount")

```

#Search Trends

```{r search,echo=FALSE}
data_path="C:/Users/user/Desktop/Data/dolar.csv"
dolar <- read.csv(data_path,skip=2)
dolar=data.table(dolar)
dolar[,"Date":=veri$Date]
dolar[,Ay:=NULL]
dolar[,"Search":=dolar]
dolar[,dolar:=NULL]

data_path="C:/Users/user/Desktop/Data/enflasyon.csv"
enflasyon <- read.csv(data_path,skip=2)
enflasyon=data.table(enflasyon)
enflasyon[,"Date":=veri$Date]
enflasyon[,Ay:=NULL]
enflasyon[,"Search":=enflasyon]
enflasyon[,enflasyon:=NULL]

data_path="C:/Users/user/Desktop/Data/kredi.csv"
kredi <- read.csv(data_path,skip=2)
kredi=data.table(kredi)
kredi[,"Date":=veri$Date]
kredi[,Ay:=NULL]
kredi[,"Search":=kredi]
kredi[,kredi:=NULL]
```

```{r sel,echo=FALSE}
dolarN=(dolar$Search-min(dolar$Search))/(max(dolar$Search)-min(dolar$Search))
enflasyonN=(enflasyon$Search-min(enflasyon$Search))/(max(enflasyon$Search)-min(enflasyon$Search))
krediN=(kredi$Search-min(kredi$Search))/(max(kredi$Search)-min(kredi$Search))
ggplot(veri ,aes(x=Date))+
  geom_line(aes(y=USDN,color="USD")) +
  geom_line(aes(y=dolarN,color="dolar")) +
  ggtitle("Comparison of Search Records and USD Exchange Rate",subtitle = "Over years 2017-2021")+xlab("Date")+ylab("Normalized Data")
ggplot(veri ,aes(x=Date))+
  geom_line(aes(y=GeneralN,color="General")) +
  geom_line(aes(y=enflasyonN,color="enflasyon")) +
  ggtitle("Comparison of Search Records and General Price Index",subtitle = "Over years 2017-2021")+xlab("Date")+ylab("Normalized Data")
ggplot(veri ,aes(x=Date))+
  geom_line(aes(y=ConsumerN,color="Consumer")) +
  geom_line(aes(y=krediN,color="kredi")) +
  ggtitle("Comparison of Search Records and Consumer Loan Amount",subtitle = "Over years 2017-2021")+xlab("Date")+ylab("Normalized Data")
```

```{r corr,echo=FALSE}
paste("Correlation between search records and data:")
paste("For Exchange Rate: ",cor(veri$USD,dolar$Search))
paste("For Price Index: ",cor(veri$General,enflasyon$Search))
paste("For Loan Amount: ",cor(veri$Consumer,kredi$Search))
```

```{r boxplot,echo=FALSE}
ggplot(dolar,aes(x=factor(year(Date)),y=Search,fill=factor(year(Date)))) + geom_boxplot()+labs(x="Year",y="Search Amount",
title="Boxplots of Search Amount of The Word \"dolar\" ",subtitle="Over the Years 2017-2021")
ggplot(enflasyon,aes(x=factor(year(Date)),y=Search,fill=factor(year(Date)))) + geom_boxplot()+labs(x="Year",y="Search Amount",
title="Boxplots of Search Amount of The Word \"enflasyon\" ",subtitle="Over the Years 2017-2021") 
ggplot(kredi,aes(x=factor(year(Date)),y=Search,fill=factor(year(Date)))) + geom_boxplot() +labs(x="Year",y="Search Amount",
title="Boxplots of Search Amount of The Word \"kredi\" ",subtitle="Over the Years 2017-2021")

```















